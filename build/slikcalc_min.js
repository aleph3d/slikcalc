/*/**
 * Copyright (c) 2008 Brad Harris - bmharris@gmail.com
 * http://slikcalc.selfcontained.us
 * Code licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 * version X.X
 */
var slikcalc;if(!slikcalc){slikcalc={}}else{if(typeof slikcalc!="object"){throw new Error("slikcalc already exists and is not an object")}}slikcalc={adapter:null,getValue:function(B){var C=null,A=this.get(B);if(A!==null){C=this.isInput(A)?A.value:A.innerHTML}return C},setValue:function(B,C){var A=this.get(B);if(A!==null){if(this.isInput(A)){A.value=C}else{A.innerHTML=C}}},getAmount:function(B){var A=this.getValue(B);A=A!==null?parseFloat(this.formatCurrency(A)):parseFloat(this.formatCurrency(0));return A},setAmount:function(A,B){this.setValue(A,this.formatCurrency(B))},isInput:function(A){return A.tagName==="INPUT"||A.tagName==="TEXTAREA"||A.tagName==="SELECT"},formatCurrency:function(A){if(A!==undefined&&typeof A==="string"){A=A.replace(/[$,]/,"")}A=isNaN(A)||A===""||A===null?0:A;return parseFloat(A).toFixed(2)},trim:function(A){return A.replace(/^\s+|\s+$/g,"")},get:function(A){this.validateAdapter();return this.adapter.get(A)},validateAdapter:function(){if(this.adapter===null){throw new Error("slikcalc requires an external javascript library adapter")}},addListener:function(A,C,D,B){this.validateAdapter();this.adapter.addListener(A,C,D,B)},addOnLoad:function(B,A){this.validateAdapter();this.adapter.addOnLoad(B,A)},createCustomEvent:function(A){this.validateAdapter();return this.adapter.createCustomEvent(A)},bindEvent:function(B,C,A){this.validateAdapter();this.adapter.bindEvent(B,C,A)},fireEvent:function(A){this.validateAdapter();this.adapter.fireEvent(A)},extend:function(B,C){if(!C||!B){throw new Error("slikcalc.extend failed, please check that all dependencies are included.")}var A=function(){};A.prototype=C.prototype;B.prototype=new A();B.prototype.constructor=B;B.prototype.parent=C.prototype;B.prototype.parent.constructor=C},create:function(C,B){var A=C==="column"?slikcalc.ColumnCalc:C==="formula"?slikcalc.FormulaCalc:null;return A!==null?new A(B):null}};slikcalc.BaseCalc=function(A){A.total=A.total||{};this.totalId=A.total.id||null;this.totalOperator=A.total.operator||"+";this.calcOnLoad=A.calcOnLoad||false;this.calculationComplete=slikcalc.createCustomEvent("calculationComplete");this.registerListeners=A.registerListeners||false;slikcalc.addOnLoad(this.baseInitialize,this)};slikcalc.BaseCalc.prototype={calculationComplete:null,lastKeyUp:null,calculations:0,totalId:null,totalOperator:null,calcOnLoad:false,registerListeners:false,keyupDelay:600,initialized:false,baseInitialize:function(){if(this.initialized===false){this.initialized=true;if(this.initialize!==undefined&&typeof this.initialize==="function"){this.initialize()}if(this.calcOnLoad===true){this.processCalculation()}}},dependsOn:function(A){slikcalc.bindEvent(A.calculationComplete,this.processCalculation,this);return A},triggers:function(A){slikcalc.bindEvent(this.calculationComplete,A.processCalculation,A);return A},keyupEvent:function(){this.lastKeyup=new Date().getTime();this.calculations=this.calculations+1;var A=this,B=this.calculations;setTimeout(function(){var C=new Date().getTime(),D=C-A.lastKeyup;if(B==A.calculations&&D>A.keyupDelay){A.processCalculation()}},(this.keyupDelay+100))},calculateTotal:function(B,A){if(this.totalOperator==="+"){B=B===null?0:B;B=B+A}else{if(this.totalOperator==="-"){if(B===null){B=A}else{B=B-A}}else{if(this.totalOperator==="*"||this.totalOperator==="x"){B=B===null?1:B;B=B*A}else{if(this.totalOperator==="/"){if(B===null){B=A}else{B=B/A}}}}}return B},processCalculation:function(){if(this.initialized===false){this.baseInitialize()}this.calculate();slikcalc.fireEvent(this.calculationComplete)},calculate:function(){throw new Error("Must implement calculate method in sub-class of BaseCalc")}};slikcalc.ColumnCalc=function(A){this.parent.constructor.call(this,A);this.rows=[]};slikcalc.extend(slikcalc.ColumnCalc,slikcalc.BaseCalc);slikcalc.ColumnCalc.prototype.rows=null;slikcalc.ColumnCalc.prototype.initialize=function(){if(this.registerListeners===true){this.setupEventListeners()}};slikcalc.ColumnCalc.prototype.calculate=function(){var C=null;for(var A in this.rows){if(this.rows.hasOwnProperty(A)){var B=true;if(this.rows[A].checkbox!==undefined){var D=this.rows[A].checkbox;B=(D.invert!==slikcalc.get(D.id).checked)}if(B===true){C=this.calculateTotal(C,slikcalc.getAmount(this.rows[A].id))}}}slikcalc.setAmount(this.totalId,C)};slikcalc.ColumnCalc.prototype.setupEventListeners=function(){for(var A in this.rows){if(this.rows.hasOwnProperty(A)){var B=this.rows[A];if(B.checkbox!==undefined){slikcalc.addListener(B.checkbox.id,"click",this.processCalculation,this)}slikcalc.addListener(B.id,"keyup",this.keyupEvent,this)}}};slikcalc.ColumnCalc.prototype.addRow=function(A){A=A||{};if(A.checkbox!==undefined){A.checkbox.invert=A.checkbox.invert||false}this.rows.push(A)};slikcalc.FormulaCalc=function(A){this.parent.constructor.call(this,A);A=A||{};this.formula=A.formula||"";this.rows=[];this.variables=[];if(A.vars!==undefined){this.addRow({vars:A.vars})}};slikcalc.extend(slikcalc.FormulaCalc,slikcalc.BaseCalc);slikcalc.FormulaCalc.prototype.formula=null;slikcalc.FormulaCalc.prototype.formulaParsed=null;slikcalc.FormulaCalc.prototype.resultVar=null;slikcalc.FormulaCalc.prototype.varMatch=/\{(\w)\}/gi;slikcalc.FormulaCalc.prototype.rows=null;slikcalc.FormulaCalc.prototype.variables=null;slikcalc.FormulaCalc.prototype.initialize=function(){this.formulaParsed=this.formula;if(this.formulaParsed.indexOf("=")!==-1){var A=this.formulaParsed.split("=");this.formulaParsed=A[0];this.resultVar=this.varMatch.exec(slikcalc.trim(A[1]))[1]}this.varMatch.lastIndex=0;while((result=this.varMatch.exec(this.formulaParsed))!==null){this.variables.push(result[1])}this.varMatch.lastIndex=0};slikcalc.FormulaCalc.prototype.addRow=function(C){C=C||{};if(C.checkbox!==undefined){slikcalc.addListener(C.checkbox.id,"click",this.processCalculation,this);C.checkbox.invert=C.checkbox.invert||false}for(var A in C.vars){if(C.vars.hasOwnProperty(A)){var B=C.vars[A];B.defaultValue=B.defaultValue||0;C.registerListeners=C.registerListeners===true||(this.registerListeners===true&&C.registerListeners!==false);if(C.registerListeners===true){slikcalc.addListener(B.id,"keyup",this.keyupEvent,this)}}}this.rows.push(C)};slikcalc.FormulaCalc.prototype.calculate=function(){var total=0;for(var idx in this.rows){if(this.rows.hasOwnProperty(idx)){var includeRow=true,rowTotal,formulaString=this.formulaParsed;if(this.rows[idx].checkbox!==undefined){var checkbox=this.rows[idx].checkbox;includeRow=(checkbox.invert!==slikcalc.get(checkbox.id).checked)}for(var varIdx in this.variables){if(this.variables.hasOwnProperty(varIdx)){var variableName=this.variables[varIdx];var variable=this.rows[idx].vars[variableName];var value=variable.defaultValue;if(slikcalc.get(variable.id)!==null){value=slikcalc.getValue(variable.id);value=value===""?variable.defaultValue:value;value=slikcalc.formatCurrency(value)}var variableRegex=new RegExp("\\{"+variableName+"\\}");formulaString=formulaString.replace(variableRegex,value)}}rowTotal=slikcalc.formatCurrency(eval(formulaString));if(this.resultVar!==null){var resultId=this.rows[idx].vars[this.resultVar].id;slikcalc.setAmount(resultId,rowTotal)}if(includeRow===true&&this.totalOperator!==null){total=this.calculateTotal(total,parseFloat(rowTotal))}}}if(this.totalId!==null){slikcalc.setAmount(this.totalId,total)}};